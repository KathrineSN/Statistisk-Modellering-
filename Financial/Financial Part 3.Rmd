---
title: "Financial Part 3"
---

```{r}
data <- read.csv("finance_data.csv", header=TRUE,sep=";")
data$time=as.Date(data$time)
head(data,6)
```

```{r}
plot(data$time, data$SLV, type="l")
```

## Mixture models
### a) Fit normal mixture models with 2 and 3 components
```{r}
library(MASS)
library(mclust, quietly=TRUE)

fit3 = Mclust(data$SLV, G=3, model="V")
summary(fit3)

```

```{r}
fit2 = Mclust(data$SLV, G=2, model="V")
summary(fit2)
```
The normal mixture model with 3 components is better than the model with 2 components, looking at both the log-likelihood and the BIC score. 

### b) Report confidence intervals for the parameters and give an interpretation of these intervals. 
```{r}
fit3$parameters$mean[1]+c(1,-1)*sqrt(fit3$parameters$variance$sigmasq[1])*qnorm(0.975)
fit3$parameters$mean[2]+c(1,-1)*sqrt(fit3$parameters$variance$sigmasq[2])*qnorm(0.975)
fit3$parameters$mean[3]+c(1,-1)*sqrt(fit3$parameters$variance$sigmasq[3])*qnorm(0.975)

```
All the confidence intervals for the mean parameters include zero, meaning that all the gaussian distributions are centered around zero. That probably okay, given that this is a confidence interval for the mean. 

## c) Make a profile likelihood plot of one of the variance parameters in the two component model.  

```{r}
# Profile likelihood normal distribution
lp.sig <- function(sigma2,y){ n <- length(x)
sigma.hat.sq <- sum((x - mean(x))^2) / n
- sigma.hat.sq * n/(2 * sigma2) +log(sigma2^(- n / 2))
}

```




## Markov Chain
```{r}
y <- data$SLV

```

```{r}
source("A1.R")
y <- data$SLV

## 2 - state 
## Initial values
m <- 2
lambda0 <- quantile(y,c(0.25,0.75))
gamma0 <- matrix(0.05,ncol=m,nrow=m)
diag(gamma0) <- 1-(m-1)*gamma0[1,1]


## optimize
fit2 <- pois.HMM.mle(y,m,lambda0,gamma0)
fit2

```

```{r}
## working parameters
parvect  <- pois.HMM.pn2pw(m,fit3$lambda,fit3$gamma)
## Optimize (hessian = TRUE return hessian)
mod <- nlm(pois.HMM.mllk,parvect,x=y,m=m,
            hessian=TRUE)  
mod

## Organize the result
parvect <- mod$estimate
names(parvect) <- c("lambda1","lambda2","lambda3","tau21",
                    "tau31","tau12","tau32","tau13","tau23")

se <- sqrt(diag(solve(mod$hessian)))

## Working pars + standard error
round(cbind(parvect,se),digits=2) ## note se of tau31
fit3$gamma
```

